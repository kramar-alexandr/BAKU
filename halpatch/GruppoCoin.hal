external procedure ExtractObj(string,var Integer,var string);globalfunction string 255 NewM4PadString(string instr,Integer padlen,string padchar,Boolean padleft)BEGIN  string 255 tstr,t2;  Integer i;  Integer toff;    toff = 0;  for (i = 1; i<=padlen ;i=i+1) begin tstr = tstr & padchar; end;  if (padleft) then begin    tstr = tstr & instr;    tstr = Right(tstr,(len(tstr)-len(instr)));      end else begin    t2 = tstr;    tstr = instr;    tstr = tstr & t2;    tstr = Left(tstr,padlen);  end;    NewM4PadString = tstr;  RETURN;END;globalprocedure StocKCountGC()begin  record CoinSettingsBlock CoinSb;  record ItemStatusVc ISr;  record LocationVc Locr;  record INVc INr;  record PLVc PLr;  string 255 filename;  area ames;  string 20 curloc,datestring,barcode,price;  integer pos,storenumber; //storenumber!!!!!!!!!Необходимое для выгрузки значение Store-number. Предполагается,                           //что этот Store-number будет занесен в карточку склада.  boolean TrHs,testf,initfile;  LongInt reccnt,qty;        datestring = DateToString(CurrentDate,"YYYYMMDD");    filename = "PST" & CoinSb.ClientCode & "_" & datestring & ".TXT";  	CreateFile(filename);  	CloseFile;        BlockLoad(CoinSb);    reccnt = 0;    pos = 0;    ExtractObj(CoinSb.Locations,pos,curloc);    while (NonBlank(curloc)) begin      testf = false;      Locr.Code = curloc;      testf = ReadFirstMain(Locr,1,true);      if (testf) then begin        //storenumber = Locr.        TrHs = true;        ISr.Location = Locr.Code;        while (LoopKey("Location",ISr,1,TrHs)) begin          if (ISr.Location!=Locr.Code) then begin TrHs=false; end;          if (TrHs) then begin            if (initfile==false) then begin              AddTextToArea("**INIT**STOCOUNT" & datestring & storenumber, ames);              initfile = true;            end;            INr.Code = ISr.Code;            ReadFirstMain(INr,1,true);            if (len(INr.BarCode)==13) then begin              barcode = INr.BarCode;            end else begin              barcode = NewM4PadString(ISr.Code,13,"0",false);            end;            qty = "+" & NewM4PadString(ISr.Instock,6,"0",false);            PLr.PLCode = "RRP";            PLr.ArtCode = ISr.Code;            ReadFirstMain(PLr,2,true);            price = "+" & NewM4PadString(PLr.ExVatPrice*100,10,"0",false);            AddTextToArea("STOCOUNT" & storenumber & "I" & datestring & barcode & qty & price, ames);            reccnt = reccnt + 1;            end;        end;      end;      ExtractObj(CoinSb.Locations,pos,curloc);    end;  	   	if (initfile) then begin  	   AddTextToArea("**FINE**STOCOUNT" & datestring & storenumber & NewM4PadString(reccnt,7,"0",true), ames);  	end;	   return;end;